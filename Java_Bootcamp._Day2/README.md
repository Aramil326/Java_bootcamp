OOP/Collections

Сегодня мы научились правильно моделировать работу различных инкассаций и создавать полномасштабное приложение для 
денежных переводов с применением SOLID-принципа.

# Contents


1. [Introduction to exercises]()
2. [Exercise 00 – Models]()
3. [Exercise 01 – ID Generator]()
4. [Exercise 02 – List of Users]()
5. [Exercise 03 – List of Transactions]()
6. [Exercise 04 – Business Logic]()
7. [Exercise 05 – Menu]()

   

## Знакомство с упражнениями

Внутренняя система денежных переводов является неотъемлемой частью многих корпоративных приложений.

Ваша сегодняшняя задача — автоматизировать бизнес-процесс, связанный с переводами определенных сумм между участниками нашей системы.

Каждый пользователь системы может перевести определенную сумму другому пользователю. Нам необходимо убедиться, что даже если мы потеряем историю входящих и исходящих переводов для конкретного пользователя, мы все равно сможем восстановить эту информацию.

Внутри системы все денежные операции хранятся в виде пар дебет/кредит. Например, Джон перевел Майку 500 долларов. Система сохраняет транзакцию для обоих пользователей:

```java
John -> Mike, -500, OUTCOME, transaction ID
Mike -> John, +500, INCOME, transaction ID
```

Для восстановления соединения внутри таких пар следует использовать идентификаторы каждой транзакции.

Запись о передаче, очевидно, может быть потеряна в такой сложной системе — она может не быть записана для одного из пользователей (для эмуляции и отладки такой ситуации разработчику необходимо иметь возможность удалить данные о передаче у одного из пользователей индивидуально). Поскольку такие ситуации реальны, необходим функционал для отображения всех «неподтвержденных переводов» (транзакций, записанных только для одного пользователя) и решения таких проблем.

Ниже приведен набор упражнений, которые вы можете выполнять одно за другим для решения поставленной задачи.

## Exercise 00 – Models ([директория задания](src/ex00))

| Exercise 00: Models                                         |                                            |
|-------------------------------------------------------------|--------------------------------------------|
| Директория сдачи                                            | 	ex00                                      |
| Файлы сдачи                                                 | 	User.java, Transaction.java, Program.java |
| **Пользовательские классы могут использоваться наряду с::** |                                            |
| Types (+ all methods of these types)                        | Integer, String, UUID, enumerations        |

Ваша первая задача — разработать базовые модели предметной области, а именно классы пользователей и транзакций.

Вполне вероятно, что разные пользователи будут иметь в системе одно и то же имя. Эту проблему следует решить, добавив специальное поле для уникального идентификатора пользователя. Этот идентификатор может быть любым целым числом. Логика создания конкретного идентификатора описана в следующем упражнении.

Таким образом, для класса User характерен следующий набор состояний (полей):
- Идентификатор
- Имя
- Баланс

Класс транзакции описывает денежный перевод между двумя пользователями. Здесь также следует определить уникальный идентификатор. Поскольку количество таких транзакций может быть очень большим, определим идентификатор как строку UUID. Таким образом, для класса Transaction характерен следующий набор состояний (полей):
- Идентификатор
- Получатель (Тип пользователя)
- Отправитель (Тип пользователя)
- Категория перевода (дебет, кредит)
- Сумма перевода

Необходимо проверить начальный баланс пользователя (он не может быть отрицательным), а также баланс исходящих (только отрицательные суммы) и входящих (только положительные суммы) транзакций (использование методов get/set).

Пример использования таких классов должен содержаться в файле программы (создание, инициализация, вывод содержимого объекта на консоль). Все данные для полей класса должны быть жестко запрограммированы в программе.


### Exercise 01 – ID Generator ([директория задания](src/ex01))

| Exercise 01: ID Generator                                        |                                                 |
|------------------------------------------------------------------|-------------------------------------------------|
| Директория сдачи                                                 | 	ex01                                           |
| Файлы сдачи                                                      | 	UserIdsGenerator.java, User.java, Program.java |
| **Можно использовать все разрешения из предыдущего упражнения.** |                                                 |

Убедитесь, что каждый идентификатор пользователя уникален. Для этого создайте класс UserIdsGenerator. Поведение объекта этого класса определяет функционал генерации идентификаторов пользователей.

Современные системы управления базами данных поддерживают принцип автоинкремента, при котором каждый новый идентификатор равен значению ранее сгенерированного идентификатора +1. Итак, класс UserIdsGenerator содержит в качестве своего состояния последний сгенерированный идентификатор. Поведение UserIdsGenerator определяется методом intgenerId(), который возвращает вновь сгенерированный идентификатор при каждом вызове.

Пример использования таких классов должен содержаться в файле программы (создание, инициализация, вывод содержимого объекта на консоль).

**Примечание**:

- Убедитесь, что существует только один объект UserIdsGenerator (см. шаблон Singleton). Это необходимо, поскольку наличие нескольких объектов этого класса не может гарантировать уникальность всех идентификаторов пользователей.
- Идентификатор пользователя должен быть доступен только для чтения, поскольку он инициализируется только один раз (при создании объекта) и не может быть изменен позднее во время выполнения программы.
- В конструктор класса User необходимо добавить временную логику инициализации идентификатора:

```java
public User(...) {
	this.id = UserIdsGenerator.getInstance().generateId();
}
```


### Exercise 02 – List of Users ([директория задания](src/ex02))

| Exercise 02: List of Users                                               |                                                                    |
|--------------------------------------------------------------------------|--------------------------------------------------------------------|
| Директория сдачи	                                                        | ex02                                                               |
| Файлы сдачи                                                              | 	UsersList.java, UsersArrayList.java, User.java,Program.java, etc. |
| **Можно использовать все разрешения из предыдущего упражнения + throw.** |                                                                    |

Теперь нам нужно реализовать функционал для хранения пользователей во время работы программы.

На данный момент ваше приложение не имеет постоянного хранилища (например, файловой системы или базы данных). Однако мы хотим избежать зависимости вашей логики от способа реализации пользовательского хранилища. Чтобы обеспечить большую гибкость, давайте определим интерфейс UsersList, который описывает следующее поведение:
- Добавить пользователя
- Получить пользователя по ID
- Получить пользователя по индексу
- Получить количество пользователей

Этот интерфейс позволит разработать бизнес-логику вашего приложения так, чтобы конкретная реализация хранилища не влияла на другие компоненты системы.

Мы также реализуем класс UsersArrayList, реализующий интерфейс UsersList.

Этот класс должен использовать массив для хранения пользовательских данных. Размер массива по умолчанию равен 10. Если массив полон, его размер увеличивается вдвое. Метод добавления пользователя помещает объект типа Пользователь в первую пустую (свободную) ячейку массива.

В случае попытки получить пользователя с несуществующим идентификатором должно быть выброшено непроверенное исключение UserNotFoundException.

Пример использования таких классов должен содержаться в файле программы (создание, инициализация, вывод содержимого объекта на консоль).

**Примечание**:<br>
Вложенный ArrayList<T>класс Java имеет ту же структуру. Смоделировав поведение этого класса самостоятельно, вы научитесь использовать механизмы этого класса стандартной библиотеки.


### Exercise 03 – List of Transactions ([директория задания](src/ex03))

| Exercise 03: List of Transactions                                |                                                                                   |
|------------------------------------------------------------------|-----------------------------------------------------------------------------------|
| Директория сдачи                                                 | 	ex03                                                                             |
| Файлы сдачи                                                      | TransactionsList.java, TransactionsLinkedList.java, User.java, Program.java, etc. |
| **Можно использовать все разрешения из предыдущего упражнения.** |                                                                                   |

В отличие от пользователей, список транзакций требует особого подхода к реализации. Поскольку количество операций создания транзакций может быть очень большим, нам нужен метод хранения, чтобы избежать дорогостоящего увеличения размера массива.

В этой задаче мы предлагаем вам создать интерфейс TransactionsList, описывающий следующее поведение:
- Добавить транзакцию
- Удалить транзакцию по идентификатору (в данном случае используется строковый идентификатор UUID)
- Преобразование в массив (например, Transaction[] toArray())

Список транзакций должен быть реализован в виде связанного списка (LinkedList) в классе TransactionsLinkedList. Поэтому каждая транзакция должна содержать поле со ссылкой на следующий объект транзакции. Если предпринята попытка удалить транзакцию с несуществующим идентификатором, должно быть выдано исключение времени выполнения TransactionNotFoundException. Пример использования таких классов должен содержаться в файле программы (создание, инициализация, вывод содержимого объекта на консоль).

**Примечание**:<br>

- Нам нужно добавить поле транзакций типа TransactionsList в класс User, чтобы каждый пользователь мог хранить список своих транзакций.
- Транзакция должна быть добавлена с помощью ОДИНОЧНОЙ операции (O(1))
- LinkedList<T>вложенный класс Java имеет ту же структуру — двунаправленный связанный список.


### Exercise 04 – Business Logic ([директория задания](src/ex04))

| Exercise 04: Business Logic                                      |                                               |
|------------------------------------------------------------------|-----------------------------------------------|
| Директория сдачи                                                 | 	ex04                                         |
| Файлы сдачи                                                      | 	TransactionsService.java, Program.java, etc. |
| **Можно использовать все разрешения из предыдущего упражнения.** |                                               |

Уровень бизнес-логики приложения расположен в классах обслуживания. Такие классы содержат базовые алгоритмы системы, автоматизированные процессы и т. д. Эти классы обычно разрабатываются на основе паттерна Фасад, способного инкапсулировать поведение нескольких классов.

В этом случае класс TransactionsService должен содержать поле типа UserList для взаимодействия с пользователем и обеспечивать следующий функционал:
- Добавление пользователя
- Получение баланса пользователя
- Выполнение транзакции перевода (указываются идентификаторы пользователей и сумма перевода). В этом случае создаются две транзакции типа ДЕБЕТ/КРЕДИТ и добавляются к получателю и отправителю. Идентификаторы обеих транзакций должны быть равны
- Получение переводов конкретного пользователя (возвращается МАССИВ переводов). Удаление транзакции по идентификатору для конкретного пользователя (указывается идентификатор транзакции и идентификатор пользователя)
- Проверить достоверность транзакций (возвращает МАССИВ непарных транзакций).

В случае попытки перевода суммы, превышающей остаточный баланс пользователя, должно быть выдано исключение времени выполнения IllegalTransactionException.

Пример использования таких классов должен содержаться в файле программы (создание, инициализация, вывод содержимого объекта на консоль).


### Exercise 05 – Menu ([директория задания](src/ex05))

| Exercise 05: Menu                                                                      |                                |
|----------------------------------------------------------------------------------------|--------------------------------|
| Директория сдачи                                                                       | 	ex05                          |
| Файлы сдачи                                                                            | 	Menu.java, Program.java, etc. |
| **Можно использовать все разрешения из предыдущего упражнения., as well as try/catch** |                                |

В результате у вас должно получиться работающее приложение с консольным меню. Функциональность меню должна быть реализована в соответствующем классе с полем ссылки на TransactionsService.

Каждый пункт меню должен сопровождаться номером команды, введенной пользователем для вызова действия.

Приложение должно поддерживать два режима запуска — производственный (стандартный режим) и режим разработки (где информация о передаче для конкретного пользователя может быть удалена по идентификатору пользователя, а также может быть запущена функция, проверяющая достоверность всех передач).

Если генерируется исключение, появится сообщение, содержащее информацию об ошибке, и пользователю будет предоставлена возможность ввести действительные данные.

Сценарий работы приложения следующий (программа должна внимательно следовать этому примеру вывода):
```
$ java Program --profile=dev

1. Add a user
2. View user balances
3. Perform a transfer
4. View all transactions for a specific user
5. DEV – remove a transfer by ID
6. DEV – check transfer validity
7. Finish execution
-> 1
Enter a user name and a balance
-> Jonh 777
User with id = 1 is added
---------------------------------------------------------
1. Add a user
2. View user balances
3. Perform a transfer
4. View all transactions for a specific user
5. DEV – remove a transfer by ID
6. DEV – check transfer validity
7. Finish execution
-> 1
Enter a user name and a balance
-> Mike 100
User with id = 2 is added
---------------------------------------------------------
1. Add a user
2. View user balances
3. Perform a transfer
4. View all transactions for a specific user
5. DEV – remove a transfer by ID
6. DEV – check transfer validity
7. Finish execution
-> 3
Enter a sender ID, a recipient ID, and a transfer amount
-> 1 2 100
The transfer is completed
---------------------------------------------------------
1. Add a user
2. View user balances
3. Perform a transfer
4. View all transactions for a specific user
5. DEV – remove a transfer by ID
6. DEV – check transfer validity
7. Finish execution
-> 3
Enter a sender ID, a recipient ID, and a transfer amount
-> 1 2 150
The transfer is completed
---------------------------------------------------------
1. Add a user
2. View user balances
3. Perform a transfer
4. View all transactions for a specific user
5. DEV – remove a transfer by ID
6. DEV – check transfer validity
7. Finish execution
-> 3
Enter a sender ID, a recipient ID, and a transfer amount
-> 1 2 50
The transfer is completed
---------------------------------------------------------
1. Add a user
2. View user balances
3. Perform a transfer
4. View all transactions for a specific user
5. DEV – remove a transfer by ID
6. DEV – check transfer validity
7. Finish execution
-> 2
Enter a user ID
-> 2
Mike - 400
---------------------------------------------------------
1. Add a user
2. View user balances
3. Perform a transfer
4. View all transactions for a specific user
5. DEV – remove a transfer by ID
6. DEV – check transfer validity
7. Finish execution
-> 4
Enter a user ID
-> 1
To Mike(id = 2) -100 with id = cc128842-2e5c-4cca-a44c-7829f53fc31f
To Mike(id = 2) -150 with id = 1fc852e7-914f-4bfd-913d-0313aab1ed99
TO Mike(id = 2) -50 with id = ce183f49-5be9-4513-bd05-8bd82214eaba
---------------------------------------------------------
1. Add a user
2. View user balances
3. Perform a transfer
4. View all transactions for a specific user
5. DEV – remove a transfer by ID
6. DEV – check transfer validity
7. Finish execution
-> 5
Enter a user ID and a transfer ID
-> 1 1fc852e7-914f-4bfd-913d-0313aab1ed99
Transfer To Mike(id = 2) 150 removed
---------------------------------------------------------
1. Add a user
2. View user balances
3. Perform a transfer
4. View all transactions for a specific user
5. DEV – remove a transfer by ID
6. DEV – check transfer validity
7. Finish execution
-> 6
Check results:
Mike(id = 2) has an unacknowledged transfer id = 1fc852e7-914f-4bfd-913d-0313aab1ed99 from John(id = 1) for 150
```
